<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Game Hub</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<style>
:root{
  --bg:#050914;
  --card:#0e162a;
  --neon:#00ffff;
  --text:#ffffff;
}
*{box-sizing:border-box;font-family:Arial}
body{
  margin:0;
  background:radial-gradient(circle at top,#0f1e3d,var(--bg));
  color:var(--text);
}
#logo{
  width:100px;
  height:100px;
  border-radius:50%;
  display:block;
  margin:10px auto;
  cursor:pointer;
  object-fit:cover;
  border:2px solid var(--neon);
  transition:0.3s;
}
#logo:hover{
  box-shadow:0 0 20px var(--neon);
  transform:scale(1.1);
}
.admin{color:gold;font-weight:bold}

@media(max-width:900px){
  body::before{
    content:"üö´ COMPUTER ONLY";
    position:fixed;inset:0;
    background:black;
    display:grid;
    place-items:center;
    font-size:2rem;
    z-index:9999;
  }
}

#login{height:100vh;display:grid;place-items:center;}
.login-box{
  background:var(--card);
  padding:30px;
  border-radius:15px;
  box-shadow:0 0 25px var(--neon);
  width:300px;
}
.login-box input,button{
  width:100%;
  padding:10px;
  margin-bottom:10px;
  border:none;
  border-radius:8px;
}
.login-box button{background:var(--neon);font-weight:bold;cursor:pointer;}

#app{display:none}
header{
  background:#060b18;
  padding:12px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
header button{
  background:none;
  border:1px solid var(--neon);
  color:white;
  padding:8px 14px;
  cursor:pointer;
  border-radius:8px;
}
header button:hover{background:var(--neon);color:black;}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:20px;
}
.card{
  background:var(--card);
  padding:20px;
  border-radius:15px;
  text-align:center;
  cursor:pointer;
}
.card:hover{transform:scale(1.05);box-shadow:0 0 25px var(--neon);}
iframe{width:100%;height:80vh;border:none;}

#chatBox{background:#111;padding:10px;height:200px;overflow-y:auto;border-radius:10px;margin-top:10px;}
#chatInput{width:75%;padding:10px;border-radius:8px;border:none;}
#chatSend{padding:10px;background:var(--neon);border:none;border-radius:8px;cursor:pointer;}
#leaderboard{margin-top:20px;background:#111;padding:10px;border-radius:10px;}
.onlineUser{margin-bottom:5px;}
#loading{position:fixed;inset:0;display:grid;place-items:center;font-size:2rem;background:#050914;color:#00ffff;z-index:9999;}
</style>
</head>

<body>

<div id="loading">Loading Game Hub...</div>

<img id="logo" src="https://i.imgur.com/4b1852c6.png" alt="Game Hub Logo" onclick="goHome()">

<div id="login">
  <div class="login-box">
    <h2>Login</h2>
    <input id="username" placeholder="Username">
    <input id="pw" type="password" placeholder="Password">
    <button onclick="login()">Enter</button>
    <p id="err"></p>
  </div>
</div>

<div id="app">
<header>
  <button onclick="showCategory('classic')">Classic</button>
  <button onclick="showCategory('action')">Action & Racing</button>
  <button onclick="showCategory('horror')">Horror</button>
  <button onclick="showCategory('study')">Study</button>
  <button id="adminBtn" onclick="adminPanel()" style="display:none;">Admin üëë</button>
</header>

<div id="game"></div>

<div id="chatBox"></div>
<input id="chatInput"><button id="chatSend">Send</button>

<div id="leaderboard">
  <h2>üèÜ Leaderboard</h2>
  <div id="leaderboardList"></div>
</div>
</div>

<script>
// üî• Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBux7pWgXvmyUTtJ3xdqe9ittaIBQiSDB4",
  authDomain: "game-hub-9bf71.firebaseapp.com",
  projectId: "game-hub-9bf71",
  storageBucket: "game-hub-9bf71.firebasestorage.app",
  messagingSenderId: "308811078371",
  appId: "1:308811078371:web:cde710dbb1ead5d1c543d6",
  measurementId: "G-SY43VEEP0P"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();
const auth=firebase.auth();

const PASSWORD="Gamehub321";
const ADMIN_PASSWORD="BughaFortnite1";
const SECRET_PASSWORD="teacher123";
const REOPEN_PASSWORD="Reopen123";

let username=null,isAdmin=false,currentGame=null,startTime=null;

const appDiv=document.getElementById("app");
const loginDiv=document.getElementById("login");
const adminBtn=document.getElementById("adminBtn");
const gameDiv=document.getElementById("game");
const leaderboardList=document.getElementById("leaderboardList");
const chatBox=document.getElementById("chatBox");
const chatInput=document.getElementById("chatInput");
const chatSend=document.getElementById("chatSend");
const loadingDiv=document.getElementById("loading");

// Hide loading when page fully loaded
window.onload=()=>{loadingDiv.style.display="none";}

// HOME
function goHome(){showCategory('classic');}

// LOGIN
function login(){
  username=document.getElementById("username").value.trim();
  const pw=document.getElementById("pw").value;
  if(!username || !pw){document.getElementById("err").textContent="Enter username & password"; return;}
  const fakeEmail=username+"@gamehub.com";

  auth.signInWithEmailAndPassword(fakeEmail,pw)
  .then(userCredential=>{
    const user=userCredential.user;
    loginDiv.style.display="none";
    appDiv.style.display="block";
    isAdmin=pw===ADMIN_PASSWORD;
    if(isAdmin) adminBtn.style.display="inline-block";

    db.collection("users").doc(user.uid).set({
      role:isAdmin?"admin":"user",
      studyMode:false,
      online:true
    }, {merge:true});

    listenStudyMode();
    showCategory('classic');
    updateLeaderboard();
  })
  .catch(err=>{document.getElementById("err").textContent = err.message;});
}

// STUDY MODE
function listenStudyMode(){
  if(!username) return;
  auth.onAuthStateChanged(u=>{
    if(u){
      db.collection("users").doc(u.uid).onSnapshot(doc=>{
        if(doc.exists && doc.data().studyMode){
          gameDiv.innerHTML=`
          <h2>üìò Study Mode Enabled</h2>
          <div class="grid">
            <div class="card" onclick="window.open('https://my.mheducation.com/secure/student/urn:com.mheducation.openlearning:enterprise.identity.organization:prod.global:organization:bd3477a9-8c24-486d-a0bd-b8b4921bce26/home','_blank')">üìò ALEKS</div>
            <div class="card" onclick="window.open('https://www.noredink.com/learn/home','_blank')">‚úèÔ∏è NoRedInk</div>
          </div>`;
        }
      });
    }
  });
}

// SHOW CATEGORY
function showCategory(cat){
  saveTime();
  let html='';
  if(cat==='classic'){
    html=`
    <div class="grid">
      <div class="card" onclick="loadGame('Basketball Stars','https://basketball-stars.io/')">Basketball Stars</div>
      <div class="card" onclick="loadGame('Geometry Dash','https://geometrylitepc.io/')">Geometry Dash</div>
      <div class="card" onclick="loadGame('Slope','https://slopegame.io')">Slope</div>
      <div class="card" onclick="loadGame('Moto X3M','https://motox3m-free.github.io/')">Moto X3M</div>
      <div class="card" onclick="loadGame('Bloxd.io','https://bloxd.io/game/classic_survival')">Bloxd.io</div>
    </div>`;
  }
  if(cat==='action'){
    html=`
    <div class="grid">
      <div class="card" onclick="loadGame('Zombs Royale','https://zombsroyale.io/')">Zombs Royale</div>
      <div class="card" onclick="loadGame('Smash Karts','https://smashkarts.io/')">Smash Karts</div>
      <div class="card" onclick="loadGame('1v1.LOL','https://1v1-lol.gitlab.io/')">1v1.LOL</div>
      <div class="card" onclick="loadGame('Krunker','https://krunker.io/?game=DAL:349mg')">Krunker</div>
      <div class="card" onclick="loadGame('Kogama','https://www.kogama.com/')">Kogama</div>
      <div class="card" onclick="loadGame('Soccer Bros','https://soccer-bros.github.io/')">Soccer Bros</div>
      <div class="card" onclick="loadGame('Sandbox City','https://sandboxcity.net/')">Sandbox City</div>
      <div class="card" onclick="loadGame('Veck.io','https://geometrylitepc.io/veck-io')">Veck.io</div>
      <div class="card" onclick="loadGame('OpenFront','https://openfront.io/')">OpenFront</div>
      <div class="card" onclick="loadGame('Subway Surfers','https://azgames.io/subway-surfers')">Subway Surfers</div>
      <div class="card" onclick="loadGame('Voxiom','https://voxiom.io/')">Voxiom</div>
    </div>`;
  }
  if(cat==='horror'){
    html=`
    <div class="grid">
      <div class="card" onclick="loadGame('Granny','https://granny-games.com/')">Granny</div>
      <div class="card" onclick="loadGame('FNAF','https://fnafgames.io/')">FNAF</div>
      <div class="card" onclick="loadGame('FNAF 2','https://fnaf-2.io/')">FNAF 2</div>
      <div class="card" onclick="loadGame('Sister Location','https://fngames.io/five-nights-at-freddys-sister-location')">Sister Location</div>
    </div>`;
  }
  if(cat==='study'){
    html=`<h2>üìò Study Mode</h2>`;
  }
  gameDiv.innerHTML=html;
}

// LOAD GAME (fullscreen)
function loadGame(name, url){
  saveTime();
  currentGame=name;
  startTime=Date.now();

  auth.onAuthStateChanged(u=>{
    if(u){
      db.collection("leaderboard").doc(u.uid).set({
        plays: firebase.firestore.FieldValue.increment(1),
        admin: isAdmin
      }, {merge:true});
    }
  });

  // Create iframe
  const iframe=document.createElement('iframe');
  iframe.src=url;
  iframe.style.width="100%";
  iframe.style.height="100vh";
  iframe.style.border="none";

  // Clear and append iframe
  gameDiv.innerHTML='';
  gameDiv.appendChild(iframe);

  // Request fullscreen
  if (iframe.requestFullscreen) iframe.requestFullscreen();
  else if (iframe.webkitRequestFullscreen) iframe.webkitRequestFullscreen();
  else if (iframe.msRequestFullscreen) iframe.msRequestFullscreen();
}

// SAVE TIME
function saveTime(){
  if(currentGame && startTime){
    const sec=Math.floor((Date.now()-startTime)/1000);
    auth.onAuthStateChanged(u=>{
      if(u){
        db.collection("timePlayed").doc(u.uid).set({
          [currentGame]: firebase.firestore.FieldValue.increment(sec)
        }, {merge:true});
      }
    });
  }
}

// CHAT
chatSend.onclick=()=>{
  if(chatInput.value){
    auth.onAuthStateChanged(u=>{
      if(u){
        db.collection("chat").add({
          user:username,
          msg:chatInput.value,
          admin:isAdmin,
          time:Date.now()
        });
      }
    });
    chatInput.value='';
  }
};

// LIVE CHAT
db.collection("chat").orderBy("time").onSnapshot(s=>{
  chatBox.innerHTML="";
  s.forEach(d=>{
    chatBox.innerHTML+=`<div><b class="${d.data().admin?'admin':''}">${d.data().user}${d.data().admin?' üëë':''}:</b> ${d.data().msg} ${isAdmin?`<button onclick="db.collection('chat').doc('${d.id}').delete()">üóë</button>`:''}</div>`;
    chatBox.scrollTop=chatBox.scrollHeight;
  });
});

// LEADERBOARD
function updateLeaderboard(){
  db.collection("leaderboard").onSnapshot(boards=>{
    leaderboardList.innerHTML="";
    boards.forEach(doc=>{
      const user=doc.id;
      const plays=doc.data().plays||0;
      db.collection("timePlayed").doc(user).get().then(timeDoc=>{
        let timeDetails="";
        if(timeDoc.exists){
          for(const g in timeDoc.data()){
            timeDetails+=`${g}: ${timeDoc.data()[g]}s, `;
          }
        }
        leaderboardList.innerHTML+=`<div><b>${user}${doc.data().admin?' üëë':''}</b> - Plays: ${plays} - Time: ${timeDetails}</div>`;
      });
    });
  });
}

// ADMIN PANEL
function adminPanel(){
  let html=`<h2>Admin Panel üëë</h2>`;
  html+=`<button onclick="forceStudy()">Force Study Mode</button> `;
  html+=`<button onclick="removeStudyMode()">Remove Study Mode</button> `;
  html+=`<button onclick="toggleStealth()">Stealth Mode</button> `;
  html+=`<button onclick="shutdownSite()">Shutdown Site</button>`;
  html+=`<h3>Online Users</h3><div id="onlineUsers"></div>`;
  gameDiv.innerHTML=html;

  db.collection("users").onSnapshot(s=>{
    const usersDiv=document.getElementById("onlineUsers");
    usersDiv.innerHTML="";
    s.forEach(d=>{
      const data=d.data();
      if(!data.banned){
        const userBtn=document.createElement("div");
        userBtn.className="onlineUser";
        userBtn.innerHTML=`${d.id} ${data.role==='admin'?'(Admin)':''} 
          <button onclick="banUser('${d.id}')">Ban</button> 
          <button onclick="unbanUser('${d.id}')">Unban</button>`;
        usersDiv.appendChild(userBtn);
      }
    });
  });
}

// FORCE / REMOVE STUDY MODE
function forceStudy(){db.collection("users").get().then(s=>s.forEach(d=>d.ref.update({studyMode:true}))); alert('All users forced to Study Mode');}
function removeStudyMode(){db.collection("users").get().then(s=>s.forEach(d=>d.ref.update({studyMode:false}))); alert('Study Mode removed for all users');}

// DISABLE RIGHT CLICK & F12
window.addEventListener('contextmenu', e=>e.preventDefault());
document.addEventListener('keydown', e=>{ if(e.ctrlKey||(e.key==='F12')) e.preventDefault(); });
</script>
</body>
</html>

